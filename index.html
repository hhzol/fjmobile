<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>免费电子节目单服务</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f9f9f9; }
    header { background-color: #3498db; color: white; padding: 20px 0; text-align: center; }
    nav { background-color: #2980b9; padding: 10px 0; text-align: center; }
    nav a { color: white; margin: 0 15px; text-decoration: none; }
    main { padding: 20px; max-width: 800px; margin: auto; }
    section { margin-bottom: 30px; }
    h2 { color: #2c3e50; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { padding: 0.75em; border: 1px solid #ccc; text-align: center; }
    th { background: #f0f0f0; }
    .guide { margin-top: 2em; background: #e0f7fa; padding: 1em; border-left: 4px solid #0097a7; }
    .url { font-family: monospace; color: #00796b; }
    footer { background-color: #ecf0f1; text-align: center; padding: 15px 0; color: #7f8c8d; }
  </style>
</head>
<body>
  <header>
    <h1>免费电子节目单服务</h1>
    <p>支持多种APP，永久免费，每日自动更新</p>
  </header>
  <nav>
    <a href="index.html">首页</a>
    <a href="download.html">订阅地址</a>
    <a href="channels.html">频道列表</a>
    <a href="mailto:hhz@136605.xyz">联系我们</a>
  </nav>
  <main>
    <section>
      <h2>📺 EPG下载</h2>
      <p>欢迎下载最新的EPG（电子节目单）文件，用于播放器使用。</p>
      <table>
        <tr>
          <th>EPG类型</th>
          <th>文件名称(数据/压缩包)</th>
          <th>上次更新</th>
          <th>数据时效</th>
        </tr>
        <tr>
          <td>基础频道(当天数据)</td>
          <td><a href="https://epg.136605.xyz/e.xml">e.xml</a> / <a href="https://epg.136605.xyz/e.xml.gz">e.xml.gz</a></td>
          <td><span class="update-time" id="e-xml">加载中...</span></td>
          <td id="today"></td>
        </tr>
        <tr>
          <td>基础频道(9天数据)</td>
          <td><a href="https://epg.136605.xyz/all.xml">all.xml</a> / <a href="https://epg.136605.xyz/all.xml.gz">all.xml.gz</a></td>
          <td><span class="update-time" id="all-xml">加载中...</span></td>
          <td id="range1"></td>
        </tr>
        <tr>
          <td>基础频道(9天)+扩展频道(7天)</td>
          <td><a href="https://epg.136605.xyz/more.xml">more.xml</a> / <a href="https://epg.136605.xyz/more.xml.gz">more.xml.gz</a></td>
          <td><span class="update-time" id="more-xml">加载中...</span></td>
          <td id="range2"></td>
        </tr>
      </table>
    </section>
    <section class="guide">
      <h2>📖 使用指南</h2>
      <p>推荐使用 <strong>酷9</strong> 等播放器。</p>
      <p>将EPG文件链接（如 <span class="url">https://epg.136605.xyz/more.xml.gz</span>）直接添加到“EPG订阅”中，保持自动更新。</p>
    </section>
  </main>
  <footer>
    <p>&copy; 2025 免费电子节目单服务 | <a href="mailto:hhz@136605.xyz">hhz@136605.xyz</a></p>
  </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  function formatDate(date) {
    return date.getMonth() + 1 + "月" + date.getDate() + "日";
  }

  const today = new Date();
  const todayStr = formatDate(today);
  document.getElementById("today").textContent = todayStr;

  const sixDaysAgo = new Date(today);
  sixDaysAgo.setDate(today.getDate() - 6);
  const range1 = formatDate(sixDaysAgo) + " ~ " + todayStr;
  document.getElementById("range1").textContent = range1;

  const sevenDaysLater = new Date(today);
  sevenDaysLater.setDate(today.getDate() + 6);
  const range2 = formatDate(sixDaysAgo) + " ~ " + formatDate(sevenDaysLater);
  document.getElementById("range2").textContent = range2;

  async function fetchUpdateTime(file) {
    const apiUrl = `https://api.github.com/repos/hhzol/fjmobile/commits?path=${file.name}&per_page=1`;

    try {
      const response = await fetch(apiUrl);
      if (!response.ok) {
        document.getElementById(file.elementId).textContent = "无法获取";
        return;
      }

      const data = await response.json();
      if (data.length === 0) {
        document.getElementById(file.elementId).textContent = "未找到";
        return;
      }

      const commitDate = new Date(data[0].commit.committer.date);
      const options = { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false };
      const formattedDate = commitDate.toLocaleString("zh-CN", options).replace(' ', '').replace(/(\d+)\/(\d+)/, '$1月$2日');
      document.getElementById(file.elementId).textContent = formattedDate;
    } catch (error) {
      console.error(`获取 ${file.name} 出错:`, error);
      document.getElementById(file.elementId).textContent = "获取失败";
    }
  }

  const files = [
    { name: 'e.xml', elementId: 'e-xml' },
    { name: 'all.xml', elementId: 'all-xml' },
    { name: 'more.xml', elementId: 'more-xml' }
  ];

  files.forEach(file => fetchUpdateTime(file));
});
</script>
</body>
</html>
